<script type="text/javascript" src="/resources/assets/plugins/ztree/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript">
	var jq1_4 = $.noConflict(true);
</script>
<script type="text/javascript" src="/resources/assets/plugins/ztree/js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript">
	// ready func
	jq1_4(document).ready(function(){
		// init tree
		jq1_4.fn.zTree.init(jq1_4("#subjecctTree"), setting);
	});
	var setting = {
		keep: {
			parent: true
		},
		view : {
			selectedMulti : false
		},
		data : {simpleData : {enable : true}},
		edit : {enable : false},
		async : {
			enable : true,
			url : "tree",
			autoParam : [ "id", "name", "level" ],
			dataType : "json"
		},
		callback : {
			onClick : onClick
		}
	};
	function onClick(event, treeId, treeNode) {
		$.ajax({
			type : 'post',
			async : false,
			url : '../office/office',
			data : {
				'officeId' : treeNode.id
			},
			dataType : 'json',
			success : function(obj) {
				$('#subjectId').html(treeNode.name);
			}
		});
		return true;
	};
</script>
<%
var cssPart = {
%>
<link rel="stylesheet" href="/resources/assets/css/bootstrap.min.css">
<link rel="stylesheet" href="/resources/assets/css/main.css">
<link rel="stylesheet" type="text/css" href="/resources/assets/jquery-easyui-1.4.4/themes/default/easyui.css">
<link rel="stylesheet" type="text/css" href="/resources/assets/jquery-easyui-1.4.4/themes/icon.css">
<link rel="stylesheet" type="text/css" href="/resources/assets/jquery-easyui-1.4.4//demo/demo.css">
<link rel="stylesheet" href="/resources/assets/plugins/ztree/css/metroStyle/metroStyle.css" type="text/css">
<style type="text/css">

</style>
<%};%>
<%
var jsPart = {
%>
<script type="text/javascript" src="/resources/assets/jquery-easyui-1.4.4/jquery.min.js"></script>
<script type="text/javascript" src="/resources/assets/jquery-easyui-1.4.4/jquery.easyui.min.js"></script>
<script type="text/javascript" src="/resources/assets/jquery-easyui-1.4.4/locale/easyui-lang-zh_CN.js"></script>
<script type="text/javascript">
	$(document).ready(function(){
		$('#sb').datagrid({
		    url:'/admin/subject/getListById.do', 
		    queryParams: {
				pid:'5'
			},			
		    method:"get",
		    columns:[[    
				{field:'id',title:'id',hidden:true},
		        {field:'name',title:'主题名称',width:320},
		        {field:'shareRegion',title:'共享范围',width:230},
		        {field:'operator',title:'操作',width:220,align:"center",
		        	formatter:function(value,row,index){
	                    var s = '<a href="/admin/subject/action.do?type=update&subjectId='+row.id+'">查看</a> ';
	                    return s;
		            }
		        }
		    ]]
		}); 
		
		$('#biz').datagrid({
		    url:'/admin/business/findBySubId.do', 
		    queryParams: {
		    	subjectId:'5'
			},
			rownumbers:true,
			pagination:true,
		    method:"get",
		    columns:[[    
				{field:'id',title:'id',hidden:true},
		        {field:'name',title:'业务名称',width:120},
		        {field:'code',title:'业务事项编码',width:130},
		        {field:'type',title:'业务事项分类',width:120},
		        {field:'basis',title:'办理依据',width:130},
		        {field:'chargeOfficeId',title:'业务所属部门',width:120},
		        {field:'shareRegion',title:'共享级别',width:130},
		        {field:'shareWith',title:'共享范围',width:130},
		        {field:'operator',title:'操作',width:120,align:"center",
		        	formatter:function(value,row,index){
		        		var s = '<a href="/admin/resource/action.do?type=update&id='+row.id+'">查看</a> ';
	                    var b = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
	                    var c = '<a href="#" onclick="javascript:delRscById('+row.id+');">删除</a>';
	                    return s+b+c;
		            }
		        }
		    ]]
		}); 
		
		$('#rsc').datagrid({
		    url:'/admin/business/findBySubId.do', 
		    queryParams: {
		    	subjectId:'5'
			},
			rownumbers:true,
			pagination:true,
		    method:"get",
		    columns:[[    
				{field:'id',title:'id',hidden:true},
		        {field:'name',title:'资源名称',width:120},
		        {field:'code',title:'资源代码',width:130},
		        {field:'name',title:'一级子项名称',width:120},
		        {field:'responseParty',title:'业务所属部门',width:130},
		        {field:'shareRegion',title:'资源共享范围',width:120},
		        {field:'collectWay',title:'共享方式',width:130},
		        {field:'securityLevel',title:'安全级别',width:120},
		        {field:'operator',title:'操作',width:120,align:"center",
		        	formatter:function(value,row,index){
		        		var s = '<a href="/admin/resource/action.do?type=update&id='+row.id+'">查看</a> ';
	                    var b = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
	                    var c = '<a href="#" onclick="javascript:delRscById('+row.id+');">删除</a>';
	                    return s+b+c;
		            }
		        }
		    ]]
		}); 
	});
</script>
<%};%>

<%
var htmlPart = {
%>
<!-- start:content -->
<div class="content">
  <div class="col1">
    <h3 class="h3tit1">主题目录关联</h3>
    <div>
      <input class="form-control noradius wd120" type="text" placeholder="检索">
    </div>
 	<!-- 组织机构树 start -->
	<div class="zTreeDemoBackground left">
		<ul id="subjecctTree" class="ztree"></ul>
	</div>
	<!-- 组织机构树 end -->
  </div>
  <div class="col2">
    <h3 class="h3tit" id="subjectId"></h3>
    <!-- 主题 -->
    <table id="sb"></table>
    
    <h3 class="h3tit h3posit  mt20">关联业务 <a class = "dropbtn" href="#"></a>
     <!-- 
     <div class="alert-box">
        <i class="all-icon jt-white-icon1"></i>
        <ul>
          <li><h3>检索统计</h3></li>
          <li><a href="#"><span >已关联</span>关联业务</a></li>
          <li><a href="#"><span >已关联</span>关联资源</a></li>
          <li><a href="#"><span class="vist">关联</span>资源1</a></li>
          <li><a href="#"><span class="vist">关联</span>资源2</a></li>
          <li><a href="#"><span class="vist">关联</span>资源3</a></li>
       </ul>
    </div>
    -->
    </h3>    
	
	<!-- 业务 -->   
    <table id='biz'></table>

    <h3 class="h3tit mt20">关联资源</h3>
    <!-- 资源 -->
    <table id='rsc'></table>
    
    <div class="tishi"><p>*关联主题注册通过后，部门管理员即不可修改、删除，但可以新建关联关系！</p></div>
  </div>
</div>
<!-- end:content -->
<%};
include("/layouts/admin.html",{jsSection:jsPart,htmlSection:htmlPart,cssSection:cssPart}){}
%>