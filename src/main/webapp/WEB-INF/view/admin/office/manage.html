<script type="text/javascript" src="/resources/assets/plugins/ztree/js/jquery-1.4.4.min.js"></script>
<script type="text/javascript">
var jq1_4 = $.noConflict(true);
</script>
<script type="text/javascript" src="/resources/assets/plugins/ztree/js/jquery.ztree.core-3.5.js"></script>
<script type="text/javascript" src="/resources/assets/plugins/ztree/js/jquery.ztree.excheck-3.5.js"></script>
<script type="text/javascript" src="/resources/assets/plugins/ztree/js/jquery.ztree.exedit-3.5.js"></script>

<script type="text/javascript">

	var setting = {
	    view: {
	        addHoverDom: addHoverDom,
	        removeHoverDom: removeHoverDom,
	        selectedMulti: false
	    },
	    check: {
	        //enable: true
	    },
	    data: {
	        simpleData: {
	            enable: true
	        }
	    },
	    edit: {
	        enable: true
	    },
	    async: {
			enable: true,
			url:"tree",
			autoParam:["id", "name=n", "level=lv"],
			otherParam:{"otherParam":"zTreeAsyncTest"},
			dataFilter: filter,
			dataType:"json",
		},
		callback: {
// 			beforeClick: beforeClick,
// 			beforeAsync: beforeAsync,
// 			onAsyncError: onAsyncError,
// 			onAsyncSuccess: onAsyncSuccess
		}
	};
	
	var zNodes =[
	    { id:1, pId:0, name:"父节点1", open:true},
	    { id:11, pId:1, name:"父节点11"},
	    { id:111, pId:11, name:"叶子节点111"},
	    { id:112, pId:11, name:"叶子节点112"},
	    { id:12, pId:1, name:"父节点12"},
	    { id:121, pId:12, name:"叶子节点121"},
	    { id:122, pId:12, name:"叶子节点122"},
	    { id:123, pId:12, name:"叶子节点123"},
	    { id:13, pId:1, name:"父节点13", isParent:true},
	    { id:2, pId:0, name:"父节点2"},
	    { id:21, pId:2, name:"父节点21", open:true},
	    { id:211, pId:21, name:"叶子节点211"},
	    { id:212, pId:21, name:"叶子节点212"},
	    { id:213, pId:21, name:"叶子节点213"},
	    { id:214, pId:21, name:"叶子节点214"},
	    { id:22, pId:2, name:"父节点22"},
	    { id:221, pId:22, name:"叶子节点221"},
	    { id:222, pId:22, name:"叶子节点222"},
	    { id:223, pId:22, name:"叶子节点223"},
	    { id:224, pId:22, name:"叶子节点224"},
	    { id:3, pId:0, name:"父节点3", isParent:true}
	];
	
	jq1_4(document).ready(function(){
// 		jq1_4.fn.zTree.init(jq1_4("#treeDemo"), setting, zNodes);
		jq1_4.fn.zTree.init(jq1_4("#treeDemo"), setting);
	});
	
	var newCount = 1;
	function addHoverDom(treeId, treeNode) {
	    var sObj = jq1_4("#" + treeNode.tId + "_span");
	    if (treeNode.editNameFlag || jq1_4("#addBtn_"+treeNode.tId).length>0) return;
	    var addStr = "<span class='button add' id='addBtn_" + treeNode.tId
	        + "' title='add node' onfocus='this.blur();'></span>";
	    sObj.after(addStr);
	    var btn = jq1_4("#addBtn_"+treeNode.tId);
	    if (btn) btn.bind("click", function(){
	        var zTree = jq1_4.fn.zTree.getZTreeObj("treeDemo");
	        zTree.addNodes(treeNode, {id:(100 + newCount), pId:treeNode.id, name:"new node" + (newCount++)});
	        return false;
	    });
	};
	function removeHoverDom(treeId, treeNode) {
	    jq1_4("#addBtn_"+treeNode.tId).unbind().remove();
	};
	function filter(treeId, parentNode, childNodes) {
		if (!childNodes) return null;
		for (var i=0, l=childNodes.length; i<l; i++) {
			childNodes[i].name = childNodes[i].name.replace(/\.n/g, '.');
		}
		return childNodes;
	}
</script>
<% var cssPart = { %>
<link rel="stylesheet" href="/resources/assets/css/bootstrap.min.css">
<link rel="stylesheet" href="/resources/assets/css/main.css">
<link rel="stylesheet" href="/resources/assets/plugins/ztree/css/metroStyle/metroStyle.css" type="text/css">
<style type="text/css">
.ztree .level0{
margin-left: 0px;
}
.ztree li{
margin-left: 120px;
}
</style>
<%};%>
<% var jsPart = { %>

<%};%>

<% var htmlPart = { %>
<!-- start: MAIN CONTAINER -->
<div class="content">
	<h3 class="h3tit mt30">机构目录管理</h3>
	<div class="search-sel mt20">
		<a class="btns-gray fr" href="javascript:;">导出</a><a
			class="btns-gray fr" href="javascript:;">导入</a> <a
			class="btns-gray wd fr" href="javascript:;">导入模块下载</a>
		<div class="search-inp ">
			<a href="#" class="btns-gray"><i class="all-icon xjaear-icon fl"></i>新增域</a><a
				href="#" class="btns-gray"><i class="all-icon xjbm-icon fl"></i>新增部门</a>
			<input class="form-control inp wd180" type="text" placeholder="检索">
			<i class="glyphicon glyphicon-search search-ico "></i>
		</div>
	</div>
	<div class="ml-wrap mt20 mb30">
		<div class="top-title">
			<span>一级域</span><span>二级域</span><span>一级部门</span><span>二级部门</span><span>国际代码</span>
		</div>
		<!-- 组织机构树 start -->
		<div class="zTreeDemoBackground left">
			<ul id="treeDemo" class="ztree"></ul>
		</div>
		<!-- 组织机构树 end -->
	</div>
</div>
<!-- end: MAIN CONTAINER -->
<%};
include("/layouts/admin.html",{jsSection:jsPart,htmlSection:htmlPart,cssSection:cssPart}){}
%>
